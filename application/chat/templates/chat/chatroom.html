{% extends 'chat/layout.html' %}
{% load static %}

{% block title %}Chatify | {{ room_name }}{% endblock %}

{% block script %}<script src="{% static 'chat/js/chatroom.js' %}"></script>{% endblock %}

{% block body %}
<section>

  <div class="row pt-5">
      <div class="col-12 d-flex justify-content-center">
        
          <!-- Card box-->
          <div class="card bg-dark" style="border-radius: 15px; width: 100rem;">
              {% if other_user %}
                <!-- Card Header -->
                <div class="card-header d-flex justify-content-center text-white">
                    {% if other_user.first_name %}
                        <h1>{{ other_user.first_name }}</h1>
                    {% else %}
                        <h1>{{ other_user }}</h1>
                    {% endif %}
                </div>

              {% else %}
                <!-- Card Header -->
                <div class="card-header d-flex justify-content-between align-items-center text-white">
                    <h1>{{ room.title }}</h1>
                    <i class="bi bi-gear text-light" style="font-size: 1.5rem" id="settings-icon"></i>
                </div>

                <!-- Online count -->
                <div class="card-header d-flex justify-content-center align-items-center py-0 text-info">
                    {% include 'chat/partials/online_count_partial.html' %}
                </div>
              {% endif %}

              <!-- Card body -->
              <div class="card-body d-flex flex-column bg-dark" style="height: 80vh; border-radius: 15px;">

                  <!-- Chat message box -->
                  <div class="flex-grow-1 overflow-auto" id="chat-box">
                      <div id="chat_messages">
                          {% for message in chat_messages reversed %}
                            {% include 'chat/chat_message.html' %}
                          {% endfor %}
                      </div>
                  </div>

                  <!-- Message box -->
                  <div id="chat_message_box">
                      <form hx-post="{% url 'chatroom' room_name=room.name %}" hx-ext="ws" ws-connect="/ws/room/{{ room.name }}" ws-send _="on htmx:wsAfterSend reset() me">
                          {% csrf_token %}
                          {{ form.body }}
                      </form>
                  </div>

              </div>
          </div>
      </div>
  </div>

</section>
{% endblock %}